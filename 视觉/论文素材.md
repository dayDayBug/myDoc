1、单目相机标定的意义：  
实际的相机是存在畸变的，径向畸变和切向畸变，我们要 **把带有畸变的相机校正成为理想的相机模型**，这也就是单目相机标定的意义，也是为双目标定相机提供一些计算的参数。

1.1 单目标定可以得到的参数有哪些？

- 相机的内参矩阵
- 畸变系数，通过内参矩阵和畸变系数来矫正图片
- 相机的外参矩阵（R和T）



1.2 进行相机标定需要的东西

- 工业相机

  - 工业相机两台
  - 工业相机的参数

- 标定板 

  角点的宽度方向上个数，角点高度方向上的个数 角点之间的距离

- 工业投影仪
  - 参数选择



1.3 标定流程：

①、左右相机选择某一个角度固定好，还有投影仪，固定好大概是这样的一个结构（下图只是参考的结构）。

![image-20221025165900039](https://da-ning.oss-cn-nanjing.aliyuncs.com/img202210251659760.png)

②、分为读取左右两个相机进行标定板拍摄（左右相机同时拍照），存储到相应文件中，就是根据拍摄保存的图片进行左右相机分别标定，分别存储左右相机的标定结果矩阵（内参矩阵，畸变系数矩阵，外参矩阵（R，T））；相机拍照图片的角度和数量也是有一定要求的：`当时标定实验的时候好像是上中下三层，每层左边角落、中间偏左、中间偏右以及右边角落各拍摄一张共计12张，至少是12张。拍摄完每一张之后还要根据findChessboardCorners()函数和drawChessboardCorners()函数来确定当前拍到的图片是否保留以使用。`

并不是每一张拍摄到的图片都是可以拿来用的，需要检测角点是否都被清晰的检测到了，被清晰的检测到了，才可以拿来用，否则需要重新拍照，用上面两个函数来检测图片是否可以拿来使用。

Qt界面的设计就要，有端口检测，即两个相机的数据线和工业相机的数据线检测；然后拍照，两个视角下的，左右两个显示相机拍摄到图片的框框，还要有显示画出的角点，如下图所示。

<table>
    <tr>
        <td ><center><img src="https://da-ning.oss-cn-nanjing.aliyuncs.com/img202210251729429.jpg" >
        <center>画出角点图 </center></center></td>
    </tr>
<table>




2、与之对应的是双目相机的标定：
双目相机标定是为了确定两个相机的相对位置，为它们进行 ”校正“ 自己的位置做准备，因为实际中的两个相机摆放的位置是任意的，即不是理想状况下的摆放位置；  
双目相机理想模型：也是 **极线矫正** 希望达到的效果， 两个相机光轴是平行的，光心（左右两个相机）是在同一个平面上的，并且像点在左右图像上的高度是一致的，  
这样的状态下，就可以充分利用 ”极线约束“ 的性质，只需要在同一行上搜索左右像平面的匹配点，大大降低 ”匹配“ 的时间复杂度。  

什么是 ”极线约束“ ？  
匹配是干什么的？ 首先明确我们进行标定的最终目的是进行 ”三维重建“ ，即根据不同角度下的两台相机拍摄同一个物体通过 ”视差“ 来进行重建；那么 ”视差“  
又是什么？ ”视差“ 是两台相机拍摄到的图片像素对应点之间的差值，那怎么找到对应点呢？一种方法就是 暴力枚举 的方法，也就是对两幅图片逐个像素逐个像素  
的进行比较，选出相似度最高的就是对应的 点对 ，无疑这样的时间复杂度是最高的；另一个方法就是 充分利用 ”极线约束“ 的性质，来降低 ”匹配“ 的时间复杂度。  
这就需要双目相机的标定了。

3、OpenCV中图片的存储形式是 cv::Mat;  
OpenCV中的基本数据结构：
Size  
Mat  

4、几个矩阵
- 本质矩阵、基础矩阵
- 单应矩阵：描述两个平面之间的映射关系
- 重投影矩阵  





N步相移条纹生成的公式

```cpp
#define pi acos(-1) // 宏定义 pi 为 Π, scos(-1) 表示的是 arccos(-1) 也就是Π

// N 表示N步相移的那个N
for(int k = 0; k < N; ++k) {
   	// W 表示沿着宽度方向编码
    for(int w = 1; w <= W; ++w) {
    	double I_val = A + B * cos(2. * pi * w / double(T) + 2. * k * pi / double(N));    
    }
   
}
```


$$
\left[ \begin{matrix}{l}
	1&		\cos \left( \frac{0\cdot 2\pi}{N} \right)&		-\sin \left( \frac{0\cdot 2\pi}{N} \right)\\
	\vdots&		\vdots&		\vdots\\
	1&		\cos \left( \frac{k\cdot 2\pi}{N} \right)&		-\sin \left( \frac{k\cdot 2\pi}{N} \right)\\
	\vdots&		\vdots&		\vdots\\
	1&		\cos \left( \frac{\left( N-1 \right) \cdot 2\pi}{N} \right)&		-\sin \left( \frac{\left( N-1 \right) \cdot 2\pi}{N} \right)\\
\end{matrix} \right]
$$






1、投影矩阵Q相关

2、单目标定得到的是什么，双目标定得到的是什么？

3、相机与投影仪的选择？

4、三次样条曲线的插值操作



**双目标定**

单目标定是为了计算出相机的内参矩阵，以及畸变系数矩阵；双目标定是为了确定两台相机之间的相对位置。

非理想的双目模型：

左、右相机的光心：

左、右相机的成像平面：

基线：左、右相机光心的连线；

极平面：物点与左、右两个相机光心的连线形成的平面；

极线：极平面与成像平面的交线；

**极点**：基线与像平面的交点；

像点：物点在相机成像平面上的对应点，是光心与物点的连线与成像平面的交点，是极线的一端；



**待插入 非理想的双目相机模型**



一些参数：

$P_w$：物点在世界坐标系中的坐标；

$R、t$：两个相机之间的位置关系，这里默认是的右相机到左相机的刚体变换关系；

$P_l, P_r$：分别表示相机主点的坐标，主点就是相机主视线与透视平面的交点，我理解为物点映射在成像平面上的像点；

$R_l、t_l$：分别表示物点到左相机主点的旋转、平移矩阵；

$R_r、t_r$：分别表示物点到右相机主点的旋转、平移矩阵；

根据左、右相机的成像公式有：

$P_l=R_l\cdot P_w+t_l\ $

$P_r=R_r\cdot P_w+t_r\ $

经过简单移项和左乘处理得到：

$P_w=\left( R_l \right) ^{-1}\cdot \left( P_l-t_l \right) \ $

$P_w=\left( R_r \right) ^{-1}\cdot \left( P_r-t_r \right) \ $

两式相减后整理可得：

$P_r=\left[ R_r\cdot \left( R_l \right) ^{-1} \right] P_l+\left[ t_r-R_r\cdot \left( R_l \right) ^{-1}\cdot t_l \right] \ $

右相机主点相对于左相机主点有如下的刚体变换，即：

$P_r=R\cdot P_l+T\ $

根据对应关系可以得到两相机之间的刚体变换矩阵：

$R=R_r\cdot \left( R_l \right) ^{-1}\ $  

$T=t_r-R_r\left( R_l \right) ^{-1}\cdot t_l\ $

以上公式中出现的一些参数都是已知的或者是可以通过相机的单目标定得到的参数，比如 $R_l, t_l, R_r, t_r$。

**Bougenut极线矫正方法**

具体方法：

- 共面：将右相机相对于左相机的旋转矩阵R划分为左右相机的合成矩阵 $r_l、r_r$ ，目的是实现图像平面的平行
  $$
  r_l=R^{\frac {1}{2}} ,r_r=R^{- \frac{1}{2}}
  $$

- 行对准：建立行对准矩阵 $R_{rect}$，将极点变换到无穷远处，具体操作是建立与平移向量同方向的变换矩阵 $R_{rect}$，
  $$
  R_{rect}=[e_1, e_2, e_3]^T
  $$
  其中，记 $t=[t_x,t_y,t_z]^T$，分别表示 $x,y,z$ 方向上的平移向量，有：

  - $e_1=t/||t||$ ：与平移向量 $T$ 同方向的极点
  - $e_2=\frac{[-t_y,t_x,0]^T}{\sqrt{t^2_x+t^2_y}}$：图像平面方向上的向量
  - $e_3=e_1 \times e_2$：垂直于 $e_1,e_2$ 所在平面的向量

联合 $R_{rect},r_l,r_r$ 得到最终左右相机的变换矩阵 
$$
R_{ll}=R_{rect}r_l\\
R_{rr}=R_{rect}r_r
$$








单目标定得到，相机畸变系数和内参矩阵，外参矩阵；

双目标定得到，两相机之间的相对位置关系R、T，利用R、T进行立体矫正，得到理想的双目相机模型，光轴平行，成像平面共面；

立体矫正是为了极线约束服务的，使得两个成像都是同一个高度上的，那么就方便寻找视差；

找到视差，进行三维重建，还需要





